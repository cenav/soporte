-- importe facturas por packing
select f.numero as nro_factura, f.nombre, p.pk_numero as nro_packing
     , f.fob
     , case
         when f.tflete != 1 then
           case
             when f.tflete + f.tseguro > 0 then f.tbruto - f.tflete
             else f.tbruto
           end
         else f.tbruto
       end
  as total
  from exfacturas f
       join exclientes c
            on f.cod_cliente = c.cod_cliente
       left join pk_gnumero p on f.paclis = p.pk_numero
 where p.pk_numero in (
                       53860, 53590, 53438, 52563, 52333, 52256, 52015, 51669, 53799, 53798, 53797,
                       53796, 53795, 53794, 53792, 53803, 53802, 53822, 53801, 53750, 53727, 53991,
                       53859, 53842, 53804, 53831, 53755, 54014, 54007, 54005, 53987, 53984, 53983,
                       53979, 53978, 53811, 53768, 53736, 53674, 54037, 54080, 54079, 54038, 54058,
                       54057, 54029, 54059, 53941, 53738, 53558, 53949, 53874, 53838, 53821, 53744,
                       53611, 53564, 53529, 53426, 53963, 53904, 53844, 53816, 53767, 53715, 53535,
                       53503, 53243, 53059, 52747, 52649, 52001, 51673, 51351, 54146, 54144, 53964,
                       53479, 53211, 52748, 52577, 52406, 52250, 52082, 51710, 51387, 51285, 50881,
                       50747, 54202, 54026, 53973, 53969, 53961, 53948, 53927, 53910, 53863, 53617,
                       53534, 53607, 53604, 53512, 53478, 53471, 53469, 53417, 53488, 53194, 53177,
                       53060, 52878, 52793, 52557, 52554, 52298
   );

-- prueba valor
  with comprobar as (
    select f.numero as nro_factura, f.nombre, p.pk_numero as nro_packing, f.fob
         , case
             when f.tflete != 1 then
               case
                 when f.tflete + f.tseguro > 0 then f.tbruto - f.tflete
                 else f.tbruto
               end
             else f.tbruto
           end
      as total
      from exfacturas f
           join exclientes c
                on f.cod_cliente = c.cod_cliente
           left join pk_gnumero p on f.paclis = p.pk_numero
     where f.numero in (
                        55015272, 55014940, 55015020, 55015168, 55015065, 55015260, 55014736,
                        55014814, 55014803, 55014802, 55014813, 55014927, 55014881, 55014816,
                        55014841, 55014835, 55014999, 55015025, 55015140, 55015129, 55015115,
                        55015080, 55015078, 55015066, 55015280, 55015377, 55015387, 55015375,
                        55015390, 55015389, 55015388, 55015385, 55015392, 55015383, 55015384,
                        55015391, 55015376, 55015373, 55015374, 55014901, 55014845, 55015029,
                        55015041, 55015045, 55015047, 55015048, 55015055, 55015054, 55015132,
                        55015134, 55015122, 55015086, 55015087, 55015231, 55015232, 55015234,
                        55015233, 55015242, 55015241, 55015250, 55015249, 55015243, 55015244,
                        55015245, 55015246, 55015247, 55015248, 55015251, 55015258, 55015259,
                        55015266, 55015351, 55015295, 55015296, 55015297, 55015298, 55015299,
                        55015300, 55014644, 55015418, 55015360, 55015279, 55014921, 55014849,
                        55015178, 55015283, 55015365, 55015284, 55014661, 55015056, 55015262,
                        55015265, 55015270, 55015417, 55015292, 55014525, 55012687, 55013158,
                        55013608, 55013826, 55014840, 55015024, 55015114, 55015451, 55015456,
                        55015478, 55015484, 55015477, 55015481, 55015476, 55015483, 55015482,
                        55015474, 55015480, 55015473, 55015479, 55015475, 55015359, 55013429,
                        55013032, 55013636, 55015462, 55015467, 55015469, 55015465, 55015463,
                        55015461, 55015460, 55015466, 55015464, 55015470, 55015457, 55015459,
                        55015472, 55015471, 55015458, 55015468, 55015488, 55015491, 55015082,
                        55015072, 55015513, 55015257, 55015400, 55014868, 55015141, 55015489,
                        55014243, 55015413, 55015329, 55014381, 55014618, 55015487, 55015486,
                        55015492, 55015516, 55015517, 55015515, 55015520, 55015518, 55015521,
                        55015522, 55015525, 55015524, 55015519, 55015514, 55015523, 55014166,
                        55014158, 55014100, 55014069, 55014019, 55014011, 55014783, 55014786,
                        55014801, 55014955, 55014879, 55015181, 55015147, 55015130, 55015067,
                        55015507, 55015508, 55014199, 55015281, 55015282, 55014238, 55014229,
                        55015404, 55015402, 55015285, 55014572, 55014552, 55014423, 55014428,
                        55014333, 55014342, 55014663, 55014635, 55015490, 55015534, 55015226,
                        55015347, 55015511, 55015503, 55015500, 55015502, 55015499, 55015501,
                        55015540, 55015286, 55015415, 55015324
       )
    )
select *
  from comprobar c
 where c.fob != c.total;


-- importe facturas
select f.numero as nro_factura, f.nombre, p.pk_numero as nro_packing, f.fob
  from exfacturas f
       join exclientes c
            on f.cod_cliente = c.cod_cliente
       left join pk_gnumero p on f.paclis = p.pk_numero
 where f.numero in (
                    55015256, 55015291, 55015362, 55015452, 55015610, 55015659, 55015849, 55014012,
                    55015611, 55015604, 55015688, 55015870, 55015607, 55015689, 55015871, 55015608,
                    55015690, 55015872, 55015609, 55015691, 55015873, 55015692, 55015874, 55015655,
                    55015875, 55015878, 55015879, 55015898, 55015900, 55015901, 55015902, 55015887,
                    55015804, 55015785, 55015805, 55015806, 55015808, 55015809, 55015810, 55015811,
                    55015812, 55015813, 55015814, 55015924, 55015925, 55015631, 55015795, 55015853,
                    55015792, 55015854, 55015796, 55015852, 55015797, 55015793, 55015412, 55015528,
                    55015580, 55015630, 55015674, 55015759, 55015919, 55013204, 55014574, 55014887,
                    55015079, 55015352, 55015555, 55012534, 55014051, 55015355, 55015698, 55015876,
                    55015926, 55015370, 55015544, 55015675, 55015776, 55015845, 55015915, 55015850,
                    55015884
   );